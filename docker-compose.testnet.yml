services:
  # Web3 Indexer App Service for Sepolia (Production/Testnet Mode)
  # Now fully integrated with Host-mode Infrastructure
  sepolia-indexer:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: web3-testnet-app
    network_mode: host
    environment:
      # Connect to the infrastructure Postgres on 15432
      - DATABASE_URL=postgres://postgres:W3b3_Idx_Secur3_2026_Sec@localhost:15432/web3_indexer?sslmode=disable
      - RPC_URLS=${SEPOLIA_RPC_URLS}
      - CHAIN_ID=11155111
      - START_BLOCK=${START_BLOCK:-latest}
      - PORT=8081  # Listen on host port 8081
      - LOG_LEVEL=info
      - DEMO_MODE=false
      - IS_TESTNET=true
      - MAX_SYNC_BATCH=5
      - RPC_RATE_LIMIT=1
      - FETCH_CONCURRENCY=2
    restart: unless-stopped

  # Note: Database is now handled by docker-compose.infra.yml in host mode on port 15432
