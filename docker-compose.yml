services:
  # Web3 Indexer Application
  indexer:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: ${COMPOSE_PROJECT_NAME}-app
    network_mode: host  # ğŸ‘ˆ æ ¸å¿ƒä¿®æ”¹ï¼šä½¿ç”¨ Host æ¨¡å¼ï¼Œå½»åº•æ‰“é€š Tailscale å’Œå®¿ä¸»æœºç«¯å£
    environment:
      # ç›´æ¥è¿æ¥å®¿ä¸»æœºçš„åŸºç¡€è®¾æ–½æ•°æ®åº“ (15432)
      - DATABASE_URL=postgres://postgres:W3b3_Idx_Secur3_2026_Sec@localhost:15432/web3_indexer?sslmode=disable
      - RPC_URLS=${RPC_URLS}
      - CHAIN_ID=${CHAIN_ID}
      - START_BLOCK=${START_BLOCK}
      - DEMO_MODE=${DEMO_MODE}
      - IS_TESTNET=${IS_TESTNET}
      - ENABLE_ENERGY_SAVING=${ENABLE_ENERGY_SAVING}
      - APP_TITLE=${APP_TITLE:-ğŸš€ Web3 Indexer (Default)}
      - PORT=${PORT:-8080}  # ä½¿ç”¨ç¯å¢ƒå˜é‡ä¸­çš„ç«¯å£
    restart: unless-stopped

  # Anvil Service (Only for Demo Mode)
  anvil:
    image: ghcr.io/foundry-rs/foundry:latest
    container_name: ${COMPOSE_PROJECT_NAME}-anvil
    profiles: ["demo"]
    network_mode: host # ä¹Ÿå¯ä»¥æ”¹ä¸º host
    entrypoint: ["anvil"]
    command: ["--host", "0.0.0.0", "--port", "8545", "--block-time", "1"]
    restart: always

# ç§»é™¤ç‹¬ç«‹çš„ db ç½‘ç»œå®šä¹‰ï¼Œå› ä¸ºæˆ‘ä»¬ç°åœ¨å¤ç”¨å®¿ä¸»æœºçš„åŸºç¡€è®¾æ–½