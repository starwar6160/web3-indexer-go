<!DOCTYPE html>
<html>

<head>
    <title>{{ .Title }}</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/dashboard.css">
    <style>
        /* üöÄ Critical CSS: Environment Switcher (Inlined to bypass CDN caching) */
        #env-switcher {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            height: 45px !important;
            background: #0d1117 !important; /* Ê∑±ÈªëËâ≤Â∫ïÂ±ÇÔºåÈÄÇÈÖçÂ∑•‰∏öÁ∫ßÂÆ°Áæé */
            background-color: #0d1117 !important;
            border-bottom: 1px solid #30363d !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            z-index: 9999 !important;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5) !important;
            font-family: 'JetBrains Mono', 'Courier New', monospace !important;
        }

        .banner-content {
            width: 100% !important;
            max-width: 1400px !important;
            padding: 0 20px !important;
            display: flex !important;
            justify-content: space-between !important;
            align-items: center !important;
        }

        .env-group { display: flex !important; align-items: center !important; gap: 12px !important; }
        .pulse-dot { width: 10px !important; height: 10px !important; border-radius: 50% !important; }
        .pulse-dot.sepolia { background: #00ff00 !important; box-shadow: 0 0 10px #00ff00 !important; animation: pulse-green 2s infinite !important; }
        .pulse-dot.anvil { background: #9333ea !important; box-shadow: 0 0 10px #9333ea !important; animation: pulse-purple 2s infinite !important; }

        @keyframes pulse-green { 0% { transform: scale(0.95); opacity: 0.8; } 50% { transform: scale(1.1); opacity: 1; } 100% { transform: scale(0.95); opacity: 0.8; } }
        @keyframes pulse-purple { 0% { transform: scale(0.95); opacity: 0.8; } 50% { transform: scale(1.1); opacity: 1; } 100% { transform: scale(0.95); opacity: 0.8; } }

        .env-label { color: #8b949e !important; font-size: 11px !important; font-weight: bold !important; text-transform: uppercase !important; }
        .env-name { color: #ffffff !important; font-size: 13px !important; font-weight: bold !important; }

        .switch-btn {
            text-decoration: none !important;
            font-size: 12px !important;
            padding: 4px 12px !important;
            border-radius: 6px !important;
            border: 1px solid #3b82f6 !important;
            color: #3b82f6 !important;
            font-weight: bold !important;
            transition: all 0.2s ease !important;
        }

        .switch-btn:hover { background: #3b82f6 !important; color: #ffffff !important; }
        .switch-btn.main { border-color: #f0883e !important; color: #f0883e !important; }
        .switch-btn.main:hover { background: #f0883e !important; color: #0d1117 !important; }
        
        /* Ë∞ÉÊï¥ container Èó¥Ë∑ù‰ª•ÈÄÇÈÖç fixed header */
        body { padding-top: 65px !important; }
    </style>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const title = "{{ .Title }}";
            const pulse = document.getElementById('env-pulse');
            const name = document.getElementById('env-name');
            const actions = document.getElementById('env-actions');
            const grafanaIframe = document.getElementById('grafana-iframe');

            // Â¢ûÂº∫ÁöÑÂà§Êñ≠ÈÄªËæë
            const isSepolia = title.toUpperCase().includes("SEPOLIA") || title.toUpperCase().includes("TESTNET");
            const isPublic = window.location.hostname.includes("st6160.click");

            if (isSepolia) {
                document.body.style.borderTop = "5px solid #2563eb";
                if(pulse) pulse.classList.add('sepolia');
                if(name) name.innerText = "üöÄ SEPOLIA LIVE (demo1)";
                if(actions) actions.innerHTML = '<a href="https://demo2.st6160.click" class="switch-btn">Switch to Local Lab (demo2) ‚Üí</a>';
            } else {
                document.body.style.borderTop = "5px solid #9333ea";
                if(pulse) pulse.classList.add('anvil');
                if(name) name.innerText = "üß™ LOCAL LAB (demo2)";
                if(actions) actions.innerHTML = '<a href="https://demo1.st6160.click" class="switch-btn main">‚Üê Back to Sepolia Live (demo1)</a>';
            }

            // üöÄ Âä®ÊÄÅ‰øÆÂ§ç Grafana Iframe Âú∞ÂùÄÔºåÂΩªÂ∫ïÊ∂àÈô§ "Êü•ÊâæÊú¨Âú∞ËÆæÂ§á" Ë≠¶Âëä
            if (grafanaIframe) {
                let grafanaBase = "http://localhost:4000";
                if (isPublic) {
                    grafanaBase = "https://grafana-demo2.st6160.click";
                }
                const dashboardPath = "/d/web3-indexer-sepolia/web3-indexer-sepolia?orgId=1&refresh=5s&kiosk";
                grafanaIframe.src = grafanaBase + dashboardPath;
            }
        });
    </script>
</head>

<body>
    <div id="env-switcher">
        <div class="banner-content">
            <div class="env-group">
                <span id="env-pulse" class="pulse-dot"></span>
                <span class="env-label">ENVIRONMENT:</span>
                <span id="env-name" class="env-name">Loading...</span>
            </div>
            <div id="env-actions" class="env-actions"></div>
        </div>
    </div>
    <div class="container">
        <header>
            <h1>{{ .Title }}</h1>
            <p class="header-subtitle">Real-time blockchain indexing with Go | Industrial Grade Architecture</p>
        </header>

        <div class="grid">
            <div class="card">
                <h2>üìä System Status</h2>
                <div class="stat">
                    <span class="stat-label">System State</span>
                    <span class="stat-value" id="state">
                        <span class="status-connecting">INITIALIZING...</span>
                    </span>
                </div>
                <div class="stat">
                    <span class="stat-label">Latest (on Chain)</span>
                    <span class="stat-value" id="latestBlock">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Total (Synced)</span>
                    <span class="stat-value" id="totalBlocks">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Total Transfers</span>
                    <span class="stat-value" id="totalTransfers">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Real-time TPS</span>
                    <span class="stat-value" id="tps" style="color: #ff9800; font-weight: bold;">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Processing Speed (BPS)</span>
                    <span class="stat-value" id="bps" style="color: #9c27b0;">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">E2E Latency</span>
                    <span class="stat-value" id="latency" style="color: #e91e63; font-weight: bold;">0ms</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Sync Lag (Missing)</span>
                    <span class="stat-value" id="syncLag" style="color: #667eea;">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Unique Visitors</span>
                    <span class="stat-value" id="totalVisitors" style="color: #00bcd4; font-weight: bold;">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Self-Healing</span>
                    <span class="stat-value" id="selfHealing" style="color: #28a745;">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Health</span>
                    <span id="health" class="status-badge status-warning">Checking...</span>
                </div>
                <div id="signatureStatus" style="margin-top: 5px; text-align: right;">
                    <span style="color: #666; font-size: 11px;">Unsigned Payload</span>
                </div>
                <div class="refresh-time">Last updated: <span id="lastUpdate">-</span></div>
            </div>

            <div class="card"
                style="flex: 1; background: #1e1e1e; color: #d4d4d4; font-family: 'Courier New', monospace; max-height: 300px; overflow-y: auto; border: 1px solid #333;">
                <h2
                    style="color: #fff; border-bottom: 1px solid #333; padding-bottom: 5px; font-size: 16px; margin-top: 0;">
                    üìú Engine Logs</h2>
                <div id="logEntries" style="font-size: 11px; line-height: 1.4;">
                    <div style="color: #666;">> System standby...</div>
                </div>
            </div>

            <div class="card" style="flex: 1; border: 1px solid #00bcd4;">
                <h2 style="color: #00bcd4;">üì° Visitor Audit</h2>
                <p style="color: #ccc; font-size: 13px; margin-bottom: 10px;">Dynamic Anomaly Detection Active</p>
                <div class="stat">
                    <span class="stat-label" style="font-size: 11px;">Admin/Stress IP (Auto-Filtered)</span>
                    <span class="stat-value" id="adminIP" style="font-size: 12px; color: #f44336;">None</span>
                </div>
                <div class="stat">
                    <span class="stat-label" style="font-size: 11px;">Heuristic Status</span>
                    <span class="stat-value" style="font-size: 11px; color: #28a745;">LEARNING...</span>
                </div>
                <p style="font-size: 10px; color: #666; margin-top: 10px;">Identifies IPs with >90% traffic dominance as
                    non-human/dev and excludes them from persistent stats.</p>
            </div>

            <div class="card" style="flex: 1; border: 1px solid #ff9800;">
                <h2 style="color: #ff9800;">üõ°Ô∏è Deterministic Security</h2>
                <p style="color: #ccc; font-size: 13px; margin-bottom: 15px;">Verified by EdDSA (Ed25519) Signatures</p>
                <div style="display: flex; flex-direction: column; gap: 8px;">
                    <a href="/security"
                        style="background: #ff9800; color: #000; text-align: center; padding: 10px; border-radius: 4px; text-decoration: none; font-weight: bold; transition: 0.3s;">
                        Enter Security Verification Site
                    </a>
                </div>
                <p style="font-size: 11px; color: #666; margin-top: 10px; text-align: center;">Fingerprint: FFA0 B998
                    E7AF...5DCF</p>
            </div>

            <div class="card" style="flex: 1;">
                <h2>üîó API Endpoints</h2>
                <p style="color: #666; font-size: 13px; margin-bottom: 15px;">Access detailed information via REST API
                </p>
                <div style="display: flex; flex-direction: column; gap: 8px;">
                    <a href="/healthz" style="color: #667eea; text-decoration: none; font-size: 13px;">‚Üí Health Check
                        (/healthz)</a>
                    <a href="/metrics" style="color: #667eea; text-decoration: none; font-size: 13px;">‚Üí Prometheus
                        Metrics (/metrics)</a>
                    <a href="/api/status" style="color: #667eea; text-decoration: none; font-size: 13px;">‚Üí System
                        Status (/api/status)</a>
                    <a href="/api/blocks" style="color: #667eea; text-decoration: none; font-size: 13px;">‚Üí Latest
                        Blocks (/api/blocks)</a>
                    <a href="/api/transfers" style="color: #667eea; text-decoration: none; font-size: 13px;">‚Üí Latest
                        Transfers (/api/transfers)</a>
                </div>
                <button class="action-btn" onclick="location.href='/api/admin/start-demo'">üéÆ Start Demo Mode</button>
            </div>
        </div>

        <!-- Grafana Dashboard Integration -->
        <div class="card">
            <h2>üìà Real-time Grafana Dashboard</h2>
            <p style="color: #666; font-size: 13px; margin-bottom: 15px;">Live monitoring of indexer performance metrics
            </p>
            <div
                style="border: 1px solid #222; border-radius: 12px; overflow: hidden; background: #000; height: 600px;">
                <iframe
                    id="grafana-iframe"
                    src=""
                    width="100%" height="100%" frameborder="0" style="background: #121212">
                </iframe>
            </div>
        </div>

        <div class="card">
            <h2>üì¶ Latest Blocks</h2>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Block #</th>
                        <th>Hash</th>
                        <th>Parent Hash</th>
                        <th>Timestamp</th>
                    </tr>
                </thead>
                <tbody id="blocksTable">
                    <tr>
                        <td colspan="4" class="loading">Waiting for sync...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="card">
            <h2>üí∏ Latest Transfers</h2>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Block</th>
                        <th>From</th>
                        <th>To</th>
                        <th>Amount</th>
                        <th>Token</th>
                    </tr>
                </thead>
                <tbody id="transfersTable">
                    <tr>
                        <td colspan="5" class="loading">No transactions found...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <script src="/static/dashboard.js"></script>
</body>

</html>