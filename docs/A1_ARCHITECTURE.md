# Testnet è¿ç§»ç³»ç»Ÿ - æ¶æ„æ€»ç»“

> **è®¾è®¡ç†å¿µ**ï¼šè¿½æ±‚ 6 ä¸ª 9 æŒä¹…æ€§çš„èµ„æ·±åç«¯å·¥ç¨‹å¸ˆå¦‚ä½•ç®¡ç†å¤æ‚åŸºç¡€è®¾æ–½

---

## ğŸ“ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Makefile æ§åˆ¶å±‚                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  make a1                                                   â”‚
â”‚    â”œâ”€ a1-pre-flight (5 æ­¥åŸå­åŒ–éªŒè¯)                        â”‚
â”‚    â”œâ”€ check-env (ç¯å¢ƒä¾èµ–æ£€æŸ¥)                              â”‚
â”‚    â”œâ”€ clean-testnet (ç¯å¢ƒæ¸…ç†)                              â”‚
â”‚    â””â”€ docker-compose up (å¯åŠ¨å®¹å™¨)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Pre-flight Check è„šæœ¬                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1ï¸âƒ£ RPC è¿é€šæ€§     â†’ curl eth_blockNumber                 â”‚
â”‚  2ï¸âƒ£ DB éš”ç¦»éªŒè¯    â†’ docker ps + psql -l                  â”‚
â”‚  3ï¸âƒ£ èµ·å§‹é«˜åº¦é€»è¾‘   â†’ grep START_BLOCK=latest               â”‚
â”‚  4ï¸âƒ£ é™æµé…ç½®       â†’ grep RPC_RATE_LIMIT                    â”‚
â”‚  5ï¸âƒ£ å¯è§‚æµ‹æ€§       â†’ grep /metrics                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Docker Compose (testnet)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Project: web3-testnet                                      â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ sepolia-db      â”‚    â”‚ sepolia-indexer â”‚                â”‚
â”‚  â”‚ Port: 15433     â”‚â—„â”€â”€â”€â”¤ Port: 8081      â”‚                â”‚
â”‚  â”‚ DB: web3_sepoliaâ”‚    â”‚ Chain: 11155111 â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Go Indexer åº”ç”¨å±‚                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. ç¯å¢ƒæ£€æµ‹     â†’ cfg.IsTestnet â†’ ç¡¬ç¼–ç æ¼”ç¤ºå‚æ•°            â”‚
â”‚  2. èµ·å§‹é«˜åº¦     â†’ START_BLOCK=latest â†’ åŠ¨æ€è§£æ            â”‚
â”‚  3. å®‰å…¨ä¸‹é™     â†’ MinStartBlock=10262444                   â”‚
â”‚  4. é™æµå™¨       â†’ QPS=1, Concurrency=2                     â”‚
â”‚  5. WSS é‡è¿     â†’ æŒ‡æ•°é€€é¿ (1s, 2s, 4s...)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 å¯è§‚æµ‹æ€§ä¸ç›‘æ§å±‚                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Prometheus /metrics â†’ indexer_current_height             â”‚
â”‚  â€¢ Dashboard /       â†’ åŒæ­¥è¿›åº¦ã€E2E Latency                 â”‚
â”‚  â€¢ REST API /api/    â†’ JSON çŠ¶æ€æ¥å£                        â”‚
â”‚  â€¢ Structured Logs  â†’ slog + emoji                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ æ ¸å¿ƒè®¾è®¡æ¨¡å¼

### 1. ç¯å¢ƒéš”ç¦»ï¼ˆEnvironment Isolationï¼‰

**é—®é¢˜**ï¼šå¦‚ä½•åŒæ—¶è¿è¡Œ Demoï¼ˆAnvilï¼‰å’Œ Testnetï¼ˆSepoliaï¼‰è€Œä¸å†²çªï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼š
```makefile
# Demo ç¯å¢ƒ
docker compose -p web3-demo up           # DB: 15432, API: 8080

# Testnet ç¯å¢ƒ
docker compose -p web3-testnet up        # DB: 15433, API: 8081
```

**å…³é”®ç‚¹**ï¼š
- Docker Project Name (`-p`) å®ç°å®¹å™¨çº§éš”ç¦»
- ç«¯å£æ˜ å°„ä¸åŒï¼ˆ15432 vs 15433ï¼‰
- æ•°æ®åº“åç§°ä¸åŒï¼ˆweb3_indexer vs web3_sepoliaï¼‰

---

### 2. åŸå­åŒ–éªŒè¯ï¼ˆAtomic Verificationï¼‰

**é—®é¢˜**ï¼šå¦‚ä½•é¿å…"å¯åŠ¨ 5 åˆ†é’Ÿæ‰å‘ç°é…ç½®é”™è¯¯"ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 5 ä¸ªç‹¬ç«‹æ£€æŸ¥ç‚¹ï¼Œæ¯æ­¥å¤±è´¥ç«‹å³åœæ­¢
1. RPC è¿é€šæ€§  â†’ curl eth_blockNumber
2. DB éš”ç¦»     â†’ docker ps | grep sepolia-db
3. èµ·å§‹é«˜åº¦    â†’ grep START_BLOCK=latest
4. é™æµé…ç½®    â†’ grep RPC_RATE_LIMIT=1
5. å¯è§‚æµ‹æ€§    â†’ grep /metrics
```

**å…³é”®ç‚¹**ï¼š
- æ¯æ­¥ç‹¬ç«‹å¯æµ‹ï¼Œå¿«é€Ÿå®šä½é—®é¢˜
- å¤±è´¥å³åœæ­¢ï¼Œé¿å…æ— æ•ˆå¯åŠ¨
- å½©è‰²è¾“å‡º + æ¸…æ™°çš„é”™è¯¯æç¤º

---

### 3. ä¿å®ˆé™æµï¼ˆConservative Rate Limitingï¼‰

**é—®é¢˜**ï¼šå¦‚ä½•é¿å…è§¦å‘æµ‹è¯•ç½‘ RPC çš„é¢‘ç‡é™åˆ¶ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼š
```go
// ä»¤ç‰Œæ¡¶é™æµå™¨
pool.SetRateLimit(
    cfg.RPCRateLimit,     // 1 req/sec (ä¿å®ˆå€¼)
    cfg.RPCRateLimit*2,   // Burst size = 2
)
```

**å…³é”®ç‚¹**ï¼š
- QPS=1 è¿œä½äº Provider é™åˆ¶
- å¹¶å‘=2 é¿å…è¿‡è½½
- MaxBatch=5 å°æ‰¹æ¬¡æŠ“å–

---

### 4. åŠ¨æ€èµ·å§‹é«˜åº¦ï¼ˆDynamic Start Heightï¼‰

**é—®é¢˜**ï¼šå¦‚ä½•é¿å…ä»åˆ›ä¸–å—åŒæ­¥ï¼ˆE2E Latency = 1.3 äº¿ç§’ï¼‰ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼š
```go
// ä¼˜å…ˆçº§ï¼šå‘½ä»¤è¡Œ > é…ç½® > æ£€æŸ¥ç‚¹
if cfg.StartBlockStr == "latest" {
    latestBlock, _ := rpc.GetLatestBlockNumber(ctx)
    return latestBlock + 1  // ä»ä¸‹ä¸€ä¸ªå—å¼€å§‹
}

// å®‰å…¨ä¸‹é™ä¿æŠ¤
if startBlock < 10262444 {
    startBlock = 10262444
}
```

**å…³é”®ç‚¹**ï¼š
- `START_BLOCK=latest` åŠ¨æ€è§£æ
- ç¡¬ç¼–ç æœ€å°èµ·å§‹å— 10262444
- ä¼˜å…ˆçº§æ¸…æ™°çš„é…ç½®ç³»ç»Ÿ

---

### 5. æŒ‡æ•°é€€é¿é‡è¿ï¼ˆExponential Backoffï¼‰

**é—®é¢˜**ï¼šå¦‚ä½•é¿å… WebSocket æ–­çº¿åå¯†é›†é‡è¿ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼š
```go
// æŒ‡æ•°é€€é¿ + æŠ–åŠ¨
backoff := baseBackoff * math.Pow(2, reconnectCount)
backoff *= (1.0 + rand.Float64()*0.5 - 0.25)  // Â±25% æŠ–åŠ¨
```

**å…³é”®ç‚¹**ï¼š
- 1s â†’ 2s â†’ 4s â†’ 8s â†’ ... â†’ 60s (æœ€å¤§å€¼)
- æ·»åŠ æŠ–åŠ¨é¿å…æƒŠç¾¤æ•ˆåº”
- æˆåŠŸåé‡ç½®è®¡æ•°å™¨

---

## ğŸ“Š å…³é”®æŒ‡æ ‡å¯¹æ¯”

### ä¿®å¤å‰ vs ä¿®å¤å

| æŒ‡æ ‡ | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| **èµ·å§‹å—** | #0 (åˆ›ä¸–) | #10262444 |
| **E2E Latency** | 1.3 äº¿ç§’ (4 å¹´) | < 60 ç§’ |
| **WSS é‡è¿** | å›ºå®š 5 ç§’ | æŒ‡æ•°é€€é¿ 1s~60s |
| **QPS** | 200 (è¿‡è½½) | 1 (ä¿å®ˆ) |
| **å¹¶å‘** | 10 | 2 |
| **ç¯å¢ƒéš”ç¦»** | âŒ æ··ä¹± | âœ… å®Œå…¨éš”ç¦» |

---

## ğŸ“ é¢è¯•è¯æœ¯æç‚¼

### æ¶æ„è®¾è®¡èƒ½åŠ›

> "åœ¨å¤„ç†å¤šç¯å¢ƒéƒ¨ç½²æ—¶ï¼Œæˆ‘è®¾è®¡äº† **'One Makefile, Multi-Environments'** æ¨¡å¼ï¼š
>
> - é€šè¿‡ Docker Project Name å®ç°å®¹å™¨çº§éš”ç¦»
> - ä½¿ç”¨ `.env.testnet` ä¸“é—¨ç®¡ç†æµ‹è¯•ç½‘é…ç½®
> - `a1-pre-flight` è„šæœ¬æä¾› 5 æ­¥åŸå­åŒ–éªŒè¯
>
> è¿™ç§è®¾è®¡ç¡®ä¿äº† **'ç¯å¢ƒä¸€è‡´æ€§'**ï¼Œé¿å…äº†é…ç½®æ¼‚ç§»å’Œç¯å¢ƒæ±¡æŸ“ã€‚"

### é—®é¢˜å®šä½èƒ½åŠ›

> "å½“é‡åˆ° E2E Latency çˆ†è¡¨ï¼ˆ1.3 äº¿ç§’ï¼‰æ—¶ï¼Œæˆ‘æ²¡æœ‰ç›²ç›®é‡å¯ï¼Œè€Œæ˜¯ï¼š
>
> 1. **å®šä½æ ¹å› **ï¼šå‘ç°ä»åˆ›ä¸–å—åŒæ­¥å¯¼è‡´æ—¶é—´è·¨åº¦ 4 å¹´
> 2. **ä¼˜å…ˆçº§é‡æ„**ï¼šå»ºç«‹ 'å‘½ä»¤è¡Œ > é…ç½® > æ£€æŸ¥ç‚¹' çš„æ¸…æ™°é€»è¾‘
> 3. **å®‰å…¨ä¸‹é™**ï¼šç¡¬ç¼–ç æœ€å°èµ·å§‹å— 10262444ï¼Œå½»åº•æœç»'è€ƒå¤æ¨¡å¼'
>
> ä¿®å¤å Latency é™è‡³ < 60 ç§’ï¼Œé—®é¢˜æ ¹é™¤ã€‚"

### ç¨³å®šæ€§ä¿éšœ

> "ä¸ºäº†ç¡®ä¿æµ‹è¯•ç½‘ç¨³å®šæ€§ï¼Œæˆ‘å®æ–½äº†**å¤šå±‚é˜²æŠ¤**ï¼š
>
> - **é™æµå±‚**ï¼šQPS=1 çš„ä¿å®ˆé…ç½®ï¼Œé¿å…è§¦å‘ RPC é¢‘ç‡é™åˆ¶
> - **é‡è¿å±‚**ï¼šWebSocket æŒ‡æ•°é€€é¿ï¼ˆ1s â†’ 60sï¼‰ï¼Œé˜²æ­¢å¯†é›†é‡è¿é£æš´
> - **éš”ç¦»å±‚**ï¼šDocker Project Name ç¡®ä¿æµ‹è¯•ç½‘å’Œ Demo ç¯å¢ƒäº’ä¸å¹²æ‰°
>
> æ‰€æœ‰æªæ–½éƒ½éµå¾ª **'6 ä¸ª 9 æŒä¹…æ€§'** çš„æ ‡å‡†ã€‚"

---

## ğŸ“š æ–‡æ¡£æ¸…å•

| æ–‡æ¡£ | ç”¨é€” |
|------|------|
| `scripts/check-a1-pre-flight.sh` | é¢„æ£€è„šæœ¬ï¼ˆ5 æ­¥éªŒè¯ï¼‰ |
| `docs/A1_VERIFICATION_GUIDE.md` | å®Œæ•´éªŒè¯æ‰‹å†Œ |
| `docs/A1_QUICK_REF.md` | å¿«é€Ÿå‚è€ƒå¡ |
| `docs/A1_ARCHITECTURE.md` | æ¶æ„æ€»ç»“ï¼ˆæœ¬æ–‡æ¡£ï¼‰ |

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨

```bash
# å®Œæ•´æµç¨‹ï¼ˆæ¨èï¼‰
make a1-pre-flight  # é¢„æ£€
make a1             # å¯åŠ¨
make logs-testnet   # æ—¥å¿—

# å¿«é€Ÿé‡å¯ï¼ˆé¢„æ£€å·²é€šè¿‡ï¼‰
docker compose -f docker-compose.testnet.yml -p web3-testnet restart

# å®Œå…¨é‡ç½®
make reset-a1
```

---

**è®¾è®¡è€…**ï¼šè¿½æ±‚ 6 ä¸ª 9 æŒä¹…æ€§çš„èµ„æ·±åç«¯
**æœ€åæ›´æ–°**ï¼š2026-02-15
**è®¾è®¡å“²å­¦**ï¼šSmall Increments, Atomic Verification, Environment Isolation
