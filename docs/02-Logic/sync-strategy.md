# 区块同步策略：重置与锚点模式 (Reset & Anchor Mode)

> **核心目标**: 在节省 RPC 额度的同时，确保 Dashboard 上的“链式验证”从第一行开始就具备完整性。

## 1. 重置启动逻辑 (Reset Mode)
- **触发**: 通过 `make b1` 或 `make b2` 启动，底层调用 `go run ./cmd/indexer --reset`。
- **行为**: 
    1. 强制清空 `blocks` 和 `transfers` 表（`TRUNCATE`）。
    2. 重新初始化主键自增序列。
    3. 获取链上最新高度 $N$，计算起点 $S = N - 6$（安全偏移）。

## 2. 父哈希锚点修复 (Anchor Pre-fetching)
### 痛点
在传统的快速同步中，抓取的第一个块 $S$ 的 `parent_hash` 在数据库中没有对应记录，导致前端表格首行显示 `0x0000...` 或哈希断链。

### 解决方案
- **预取锚点**: 在启动实时同步前，系统会主动执行一次 `eth_getBlockByNumber(S-1)`。
- **持久化锚点**: 将 $S-1$ 号块的基础信息（Hash, Number）存入数据库。
- **效果**: 当实时同步抓取到 $S$ 号块时，数据库中已存在其父块记录，`ParentHash` 能够完美关联，实现 100% 的链式验证通过率。

## 3. 运维建议
- 演示环境推荐开启 `--reset`，以获得最干净、最连贯的视觉效果。
- 生产环境应关闭 `--reset`，依靠 `Gap Filler` 逻辑进行增量补丁。
