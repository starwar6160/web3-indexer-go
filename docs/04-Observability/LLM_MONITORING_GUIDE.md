# LLM监控和分析工具使用指南

本指南提供了快速查看Indexer状态、日志和数据库的命令，专为LLM分析优化。

## 📋 可用脚本

### 1. `llm-report.sh` - 综合LLM分析报告（推荐）

**用途**: 生成完整的系统状态报告，适合LLM全面分析

**输出内容**:
- 系统状态（容器、端口）
- API健康检查
- 同步状态
- 数据库状态
- 最新5条区块记录
- 数据一致性检查
- 最近30条关键日志
- 错误和警告
- 性能指标

**使用方法**:
```bash
./llm-report.sh
```

**示例输出**:
```
═══════════════════════════════════════════════════════════
  Web3 Indexer - LLM分析报告
  生成时间: 2026-02-09 16:31:04
═══════════════════════════════════════════════════════════

【一、系统状态】
Docker容器状态:
web3-indexer-anvil   Up 22 minutes (healthy)
web3-indexer-db      Up 22 minutes (healthy)

端口监听状态:
  Indexer API (8080): 1 个连接

【二、API健康检查】
整体状态: healthy
组件状态:
  数据库: healthy (571.95µs)
  Fetcher: healthy
  RPC: healthy (latest_block: 1369)
  Sequencer: healthy (expected_block: 51)

【三、同步状态】
服务状态: active
最新区块: 50
同步延迟: 0 blocks
已处理区块: 51

【四、数据库状态】
总区块数: 51
总交易数: 0

【五、最新区块记录（最新5条）】
区块#50 | 哈希: 0xd6baff229836af... | 时间: 1770620945
区块#49 | 哈希: 0x521722fb2a3ff2... | 时间: 1770620944
...

【六、数据一致性检查】
区块连续性: ✅ 通过 (无gaps)

【十、LLM判断建议】
请根据以上信息判断:
1. 系统是否正常运行？
2. 是否有错误或异常需要处理？
3. 数据一致性是否良好？
4. 同步进度是否符合预期？
5. 是否有性能瓶颈？
```

---

### 2. `view-logs.sh` - 查看最新日志

**用途**: 查看Indexer日志，特别关注区块处理和错误

**输出内容**:
- 最新50条日志
- 最新20条区块处理日志（过滤）
- 错误和警告
- 同步状态日志

**使用方法**:
```bash
./view-logs.sh
```

**示例输出**:
```
==================================
📦 最新区块处理日志
==================================
{"time":"...","level":"INFO","msg":"📦 Sequencer received block: 41"}
{"time":"...","level":"INFO","msg":"Processing block: 41 | Hash: 0x218696b6..."}
{"time":"...","level":"INFO","msg":"📦 Sequencer received block: 42"}
...

==================================
⚠️  错误和警告
==================================
✅ 无错误或警告
```

---

### 3. `view-db.sh` - 查看数据库记录

**用途**: 查看数据库中的最新区块和交易记录

**输出内容**:
- 数据库概览（总区块数、总交易数等）
- 最新5条区块记录
- 最新5条转账记录
- 数据一致性检查
- 同步检查点状态

**使用方法**:
```bash
./view-db.sh
```

**示例输出**:
```
==================================
💾 数据库概览
==================================
总区块数: 51
总交易数: 0
最新区块号: 50
最早区块号: 0

==================================
📦 最新5条区块记录
==================================
区块号 | 区块哈希 | 父哈希 | 时间戳 | 处理时间
------+---------------------+---------------------+------------+-------------------------------
    50 | 0xd6baff229836af... | 0x521722fb2a3ff2... | 1770620945 | 2026-02-09 07:09:24.70498+00
    49 | 0x521722fb2a3ff2... | 0xec05fb07a744c5... | 1770620944 | 2026-02-09 07:09:24.305046+00
...

==================================
✅ 数据一致性检查
==================================
区块连续性     | ✅ 通过 (无gaps)
父哈希链完整性 | ✅ 通过 (无断裂)
```

---

### 4. `check-status.sh` - 快速状态检查

**用途**: 快速检查系统是否正常运行

**输出内容**:
- Docker容器状态
- 端口监听状态
- API健康检查
- 同步状态
- 最近事件
- 错误和警告
- 数据库快照

**使用方法**:
```bash
./check-status.sh
```

---

## 🎯 快速参考

### 常用组合命令

**1. 全面检查（推荐给LLM）**:
```bash
./llm-report.sh
```

**2. 只看日志**:
```bash
./view-logs.sh | grep "block_processed" | tail -20
```

**3. 只看数据库**:
```bash
./view-db.sh
```

**4. 实时监控（每2秒刷新）**:
```bash
watch -n 2 './llm-report.sh'
```

**5. 查找错误**:
```bash
tail -500 /tmp/indexer.log | grep -iE "error|warn|panic"
```

**6. 查看最新区块处理**:
```bash
tail -200 /tmp/indexer.log | grep "Processing block" | tail -10
```

---

## 📊 输出格式说明

所有脚本都采用**纯文本格式**，包含：

- ✅ 清晰的分隔线和标题
- 📦 表情符号标识不同类型的信息
- 🔢 结构化的数据展示
- ❌/✅ 明确的成功/失败标识
- 📝 详细的说明文字

这种格式特别适合：
- LLM理解和分析
- 终端显示
- 日志记录
- 自动化脚本处理

---

## 🔍 为LLM优化的特性

1. **纯文本格式**: 不依赖JSON解析，LLM可以直接理解
2. **结构化输出**: 清晰的分区和标题
3. **关键信息突出**: 使用表情符号和颜色标识
4. **简洁明了**: 只包含关键信息，避免冗余
5. **判断提示**: 在报告末尾提供LLM判断建议

---

## 📝 LLM分析提示词

当向LLM提供报告时，可以使用以下提示词：

```
请分析以下Web3 Indexer系统状态报告，并回答：

1. 系统整体健康状态如何？
2. 是否有任何错误或异常？
3. 数据一致性是否良好？
4. 同步进度是否符合预期？
5. 如果存在问题，应该采取什么措施？

[粘贴 ./llm-report.sh 的输出]
```

---

## 🛠️ 故障排查

### 脚本无输出

**原因**: Indexer未运行或日志文件不存在

**解决**:
```bash
# 检查Indexer是否运行
ps aux | grep "go run cmd/indexer"

# 查看Indexer日志
tail -f /tmp/indexer.log
```

### 数据库连接失败

**原因**: PostgreSQL容器未运行

**解决**:
```bash
docker compose ps
docker compose up -d db
```

### API无响应

**原因**: Indexer进程崩溃或端口未监听

**解决**:
```bash
# 检查端口
lsof -i:8080

# 重启Indexer
./dev-run.sh
```

---

## 📖 更多资源

- `QUICK_START.md` - 快速开始指南
- `VERIFICATION_REPORT.md` - 完整验证报告
- `CLAUDE.md` - 项目架构文档

---

**提示**: 这些脚本会自动刷新数据，每次运行都会获取最新状态。建议在开发过程中定期运行 `./llm-report.sh` 来监控系统状态。
