services:
  # Web3 Indexer Debug Instance (Port 8083)
  # ç”¨äºæœ¬åœ°è°ƒè¯•ï¼Œå¤ç”¨ç°æœ‰çš„ web3-testnet-db æ•°æ®åº“
  debug-indexer:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: web3-debug-app
    networks:
      - web3-testnet_web3-network
    ports:
      - "8083:8080"  # æ˜ å°„åˆ°ä¸»æœº 8083 ç«¯å£
    environment:
      # RPC URLsï¼ˆä¼˜å…ˆä½¿ç”¨å•†ä¸šèŠ‚ç‚¹ï¼‰
      - RPC_URLS=${RPC_URLS:-https://rpc.sepolia.org,https://sepolia.publicnode.com,https://ethereum-sepolia.blockpi.network/v1/rpc/public}
      # è¿æ¥åˆ°å®¿ä¸»æœºåŸºç¡€è®¾æ–½æ•°æ®åº“ (éš”ç¦»çš„ debug åº“)
      - DATABASE_URL=${DATABASE_URL:-postgres://postgres:W3b3_Idx_Secur3_2026_Sec@localhost:15432/web3_debug?sslmode=disable}
      - CHAIN_ID=${CHAIN_ID:-11155111}
      - START_BLOCK=${START_BLOCK:-latest}
      - PORT=8080  # å®¹å™¨å†…éƒ¨ç«¯å£
      - LOG_LEVEL=${LOG_LEVEL:-info}
      - DEMO_MODE=${DEMO_MODE:-false}
      - IS_TESTNET=${IS_TESTNET:-true}
      - APP_TITLE=${APP_TITLE:-ğŸ”§ WEB3 INDEXER - DEBUG (Token Filtering)}
      # ä»£å¸è¿‡æ»¤é…ç½®ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
      - TOKEN_FILTER_MODE=${TOKEN_FILTER_MODE:-whitelist}
      - WATCHED_TOKEN_ADDRESSES=${WATCHED_TOKEN_ADDRESSES:-}
      # é™æµå‚æ•°ï¼ˆæ¼”ç¤ºå‹å¥½ï¼‰
      - MAX_SYNC_BATCH=${MAX_SYNC_BATCH:-3}
      - RPC_RATE_LIMIT=${RPC_RATE_LIMIT:-3}
      - FETCH_CONCURRENCY=${FETCH_CONCURRENCY:-1}
      - ENABLE_ENERGY_SAVING=${ENABLE_ENERGY_SAVING:-false}
    restart: always

networks:
  web3-testnet_web3-network:
    external: true

  # Note: å¤ç”¨ç°æœ‰çš„ web3-testnet-db æ•°æ®åº“
  #
  # å¯åŠ¨æ–¹å¼ï¼š
  # 1. ä½¿ç”¨å•†ä¸šèŠ‚ç‚¹ï¼ˆæ¨èï¼‰ï¼š
  #    docker-compose -f docker-compose.debug.yml --env-file .env.debug.commercial up -d --build
  #
  # 2. ä½¿ç”¨å…¬å…±èŠ‚ç‚¹ï¼ˆæµ‹è¯•ï¼‰ï¼š
  #    docker-compose -f docker-compose.debug.yml up -d --build
  #
  # 3. ä½¿ç”¨è‡ªå®šä¹‰ RPCï¼š
  #    export DEBUG_RPC_URLS="https://your-custom-rpc-url"
  #    docker-compose -f docker-compose.debug.yml up -d --build
