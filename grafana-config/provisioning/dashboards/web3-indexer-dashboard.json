{
  "annotations": { "list": [] },
  "editable": true,
  "gnetId": null,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "templating": {
    "list": [
      {
        "name": "Environment",
        "type": "custom",
        "options": [
          { "text": "Sepolia (8081)", "value": "sepolia", "selected": true },
          { "text": "Demo (8082)", "value": "demo", "selected": false },
          { "text": "Debug (8083)", "value": "debug", "selected": false }
        ],
        "current": { "text": "Sepolia (8081)", "value": "sepolia" }
      },
      {
        "name": "PostgresDS",
        "type": "datasource",
        "query": "postgres",
        "regex": "/Web3-${Environment}-DB/i",
        "refresh": 1
      }
    ]
  },
  "panels": [
    {
      "id": 1,
      "title": "Current Indexed Block",
      "type": "stat",
      "gridPos": { "h": 4, "w": 6, "x": 0, "y": 0 },
      "datasource": { "type": "prometheus", "uid": "prometheus_ds_001" },
      "targets": [ { "expr": "max(indexer_current_sync_height{instance=\"$Environment\"})", "refId": "A" } ],
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "reduceOptions": { "calcs": ["lastNotNull"], "values": false },
        "textMode": "auto"
      }
    },
    {
      "id": 2,
      "title": "Sync Lag (Blocks)",
      "type": "stat",
      "gridPos": { "h": 4, "w": 6, "x": 6, "y": 0 },
      "datasource": { "type": "prometheus", "uid": "prometheus_ds_001" },
      "targets": [ { "expr": "max(indexer_sync_lag_blocks{instance=\"$Environment\"})", "refId": "A" } ],
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "reduceOptions": { "calcs": ["lastNotNull"], "values": false },
        "textMode": "auto"
      }
    },
    {
      "id": 3,
      "title": "E2E Latency (Real-time)",
      "type": "stat",
      "gridPos": { "h": 4, "w": 6, "x": 12, "y": 0 },
      "datasource": { "type": "prometheus", "uid": "prometheus_ds_001" },
      "targets": [ { "expr": "max(indexer_e2e_latency_seconds{instance=\"$Environment\"})", "refId": "A" } ],
      "fieldConfig": {
        "defaults": { "unit": "s", "decimals": 1 }
      },
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "reduceOptions": { "calcs": ["lastNotNull"], "values": false }
      }
    },
    {
      "id": 4,
      "title": "RPC Health",
      "type": "stat",
      "gridPos": { "h": 4, "w": 6, "x": 18, "y": 0 },
      "datasource": { "type": "prometheus", "uid": "prometheus_ds_001" },
      "targets": [ { "expr": "max(indexer_rpc_healthy_nodes{instance=\"$Environment\"})", "refId": "A" } ],
      "options": {
        "colorMode": "background",
        "justifyMode": "center",
        "reduceOptions": { "calcs": ["lastNotNull"], "values": false },
        "textMode": "value"
      }
    },
    {
      "id": 5,
      "title": "Latest Blocks (Direct SQL Feed)",
      "type": "table",
      "gridPos": { "h": 10, "w": 24, "x": 0, "y": 4 },
      "datasource": "${PostgresDS}",
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT number AS \"Block #\", substring(hash, 1, 16) || '...' AS \"Hash\", processed_at AS \"Time\", ROUND(EXTRACT(EPOCH FROM (processed_at - to_timestamp(timestamp)))::numeric, 1) AS \"Lag\" FROM blocks ORDER BY number DESC LIMIT 10;",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": { "align": "center", "displayMode": "auto" }
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "Time" },
            "properties": [ { "id": "unit", "value": "dateTimeAsIso" } ]
          }
        ]
      }
    },
    {
      "id": 6,
      "title": "Processing TPS",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 24, "x": 0, "y": 14 },
      "datasource": { "type": "prometheus", "uid": "prometheus_ds_001" },
      "targets": [
        { "expr": "sum(rate(indexer_transfers_processed_total{instance=\"$Environment\"}[1m]))", "legendFormat": "TPS", "refId": "A" }
      ]
    }
  ],
  "refresh": "5s",
  "schemaVersion": 39,
  "style": "dark",
  "timezone": "browser",
  "title": "Web3 Indexer - Multi-Env Dashboard",
  "uid": "web3-indexer-multi",
  "version": 30
}
