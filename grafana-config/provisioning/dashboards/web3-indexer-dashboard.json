{
  "annotations": { "list": [] },
  "editable": true,
  "gnetId": null,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "templating": {
    "list": [
      {
        "name": "Environment",
        "type": "custom",
        "options": [
          { "text": "Sepolia (8081)", "value": "sepolia", "selected": true },
          { "text": "Demo (8082)", "value": "demo", "selected": false }
        ],
        "current": { "text": "Sepolia (8081)", "value": "sepolia" }
      },
      {
        "name": "PostgresDS",
        "type": "datasource",
        "query": "postgres",
        "regex": "",
        "refresh": 1,
        "current": { "text": "Web3-sepolia-DB", "value": "Web3-sepolia-DB" }
      }
    ]
  },
  "panels": [
    {
      "id": 1,
      "title": "Current Indexed Block",
      "type": "stat",
      "gridPos": { "h": 4, "w": 6, "x": 0, "y": 0 },
      "datasource": "${PostgresDS}",
      "targets": [ { "rawSql": "SELECT MAX(number) AS value FROM blocks", "format": "table", "refId": "A" } ],
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "reduceOptions": { "calcs": ["lastNotNull"], "values": false },
        "textMode": "auto"
      }
    },
    {
      "id": 2,
      "title": "Total Transfers",
      "type": "stat",
      "gridPos": { "h": 4, "w": 6, "x": 6, "y": 0 },
      "datasource": "${PostgresDS}",
      "targets": [ { "rawSql": "SELECT COUNT(*) AS value FROM transfers", "format": "table", "refId": "A" } ],
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "reduceOptions": { "calcs": ["lastNotNull"], "values": false },
        "textMode": "auto"
      }
    },
    {
      "id": 3,
      "title": "E2E Latency (SQL)",
      "type": "stat",
      "gridPos": { "h": 4, "w": 6, "x": 12, "y": 0 },
      "datasource": "${PostgresDS}",
      "targets": [ 
        { 
          "rawSql": "SELECT EXTRACT(EPOCH FROM (NOW() - MAX(processed_at))) AS value FROM blocks", 
          "format": "table", 
          "refId": "A" 
        } 
      ],
      "fieldConfig": {
        "defaults": { "unit": "s", "decimals": 1 }
      },
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "reduceOptions": { "calcs": ["lastNotNull"], "values": false }
      }
    },
    {
      "id": 4,
      "title": "Daily Unique Visitors",
      "type": "stat",
      "gridPos": { "h": 4, "w": 6, "x": 18, "y": 0 },
      "datasource": "${PostgresDS}",
      "targets": [ { "rawSql": "SELECT COUNT(DISTINCT ip_address) AS value FROM visitor_stats WHERE created_at > CURRENT_DATE", "format": "table", "refId": "A" } ],
      "options": {
        "colorMode": "background",
        "justifyMode": "center",
        "reduceOptions": { "calcs": ["lastNotNull"], "values": false },
        "textMode": "value"
      }
    },
    {
      "id": 5,
      "title": "Latest Blocks (Direct SQL Feed)",
      "type": "table",
      "gridPos": { "h": 10, "w": 24, "x": 0, "y": 4 },
      "datasource": "${PostgresDS}",
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT number AS \"Block #\", substring(hash, 1, 16) || '...' AS \"Hash\", processed_at AS \"Time\", ROUND(EXTRACT(EPOCH FROM (processed_at - to_timestamp(timestamp)))::numeric, 1) AS \"Lag\" FROM blocks ORDER BY number DESC LIMIT 10;",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": { "align": "center", "displayMode": "auto" }
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "Time" },
            "properties": [ { "id": "unit", "value": "dateTimeAsIso" } ]
          }
        ]
      }
    },
    {
      "id": 6,
      "title": "Real-time TPS (Last 5 min)",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 24, "x": 0, "y": 14 },
      "datasource": "${PostgresDS}",
      "targets": [
        { 
          "rawSql": "SELECT $__timeGroupAlias(created_at, 10s), COUNT(*)/10.0 AS \"TPS\" FROM transfers WHERE $__timeFilter(created_at) GROUP BY 1 ORDER BY 1", 
          "format": "time_series", 
          "refId": "A" 
        }
      ],
      "options": {
        "legend": { "displayMode": "list", "placement": "bottom" }
      }
    }
  ],
  "refresh": "5s",
  "schemaVersion": 39,
  "style": "dark",
  "timezone": "browser",
  "title": "Web3 Indexer - Industrial Multi-Env",
  "uid": "web3-indexer-multi",
  "version": 40
}