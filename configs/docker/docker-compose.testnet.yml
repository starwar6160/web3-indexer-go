services:
  # Web3 Indexer App Service for Sepolia (Production/Testnet Mode)
  # Now fully integrated with Host-mode Infrastructure
  sepolia-indexer:
    image: web3-indexer-go:stable
    container_name: web3-testnet-app
    deploy:
      resources:
        limits:
          memory: 128M
    network_mode: host
    environment:
      # Connect to the infrastructure Postgres on 15432
      - DATABASE_URL=postgres://postgres:uWNZugjBqixf8dxC@localhost:5432/web3_sepolia?sslmode=disable
      - RPC_URLS=${RPC_URLS}
      - CHAIN_ID=11155111
      - START_BLOCK=${START_BLOCK:-latest}
      - PORT=8081  # Listen on host port 8081
      - LOG_LEVEL=info
      - DEMO_MODE=false
      - IS_TESTNET=true
      - APP_TITLE=${APP_TITLE}
      - MAX_SYNC_BATCH=5
      - RPC_RATE_LIMIT=1
      - FETCH_CONCURRENCY=2
      - TOKEN_FILTER_MODE=${TOKEN_FILTER_MODE:-all}
      - WATCHED_TOKEN_ADDRESSES=${WATCHED_TOKEN_ADDRESSES:-}
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8081/api/status"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 10s
    restart: always

  # Note: Database is now handled by docker-compose.infra.yml in host mode on port 15432
